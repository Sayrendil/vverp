# Telegram Bot - Single Message Wizard

## –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –∑–∞—è–≤–æ–∫ –≤ Telegram –±–æ—Ç–µ —á–µ—Ä–µ–∑ **–æ–¥–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**.

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –î–æ (Multiple Messages):
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start
–ë–æ—Ç: üé´ –ù–∞—á–∏–Ω–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏...
–ë–æ—Ç: üìç –®–∞–≥ 1: –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–≥–∞–∑–∏–Ω [–∫–Ω–æ–ø–∫–∏]
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: *–Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É*
–ë–æ—Ç: ‚úÖ –ú–∞–≥–∞–∑–∏–Ω: –í–∫—É—Å–í–∏–ª–ª –Ω–∞ –õ–µ–Ω–∏–Ω–∞
–ë–æ—Ç: üìÅ –®–∞–≥ 2: –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é [–∫–Ω–æ–ø–∫–∏]
...–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ (–∏—Å—Ç–æ—Ä–∏—è –∑–∞—Å–æ—Ä—è–µ—Ç—Å—è)
```

### –ü–æ—Å–ª–µ (Single Message):
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start
–ë–æ—Ç: [–û–î–ù–û —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è]

üé´ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏

üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: ‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 30%

‚úÖ –ú–∞–≥–∞–∑–∏–Ω: –í–∫—É—Å–í–∏–ª–ª –Ω–∞ –õ–µ–Ω–∏–Ω–∞

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìÅ –®–∞–≥ 2 –∏–∑ 5: –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
[–∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π]

...—Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ß–∏—Å—Ç–∞—è –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞** - —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
‚úÖ **–í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å
‚úÖ **–í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ** - –ª–µ–≥–∫–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É–∂–µ –≤—ã–±—Ä–∞–Ω–æ
‚úÖ **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UX** - –∫–∞–∫ –≤ –ª—É—á—à–∏—Ö Telegram –±–æ—Ç–∞—Ö
‚úÖ **–ù–µ—Ç —Å—Ç–∞—Ä—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–ª—É—á–∞–π–Ω–æ –Ω–∞–∂–∞—Ç—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —à–∞–≥

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**Migration:** `2025_11_17_093553_add_message_id_to_telegram_sessions_table.php`

–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `message_id` –≤ —Ç–∞–±–ª–∏—Ü—É `telegram_sessions` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

1. **TelegramSession Model:**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `message_id`
   - –ú–µ—Ç–æ–¥—ã: `setMessageId()`, `getMessageId()`, `hasWizardMessage()`

2. **TelegramBotService:**
   - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥: `editMessageWithButtons()` –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∫–Ω–æ–ø–∫–∞–º–∏

3. **TelegramWizardService:**
   - –ú–µ—Ç–æ–¥ `buildWizardMessage()` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
   - –ú–µ—Ç–æ–¥ `buildProgressBar()` - –≤–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
   - –ú–µ—Ç–æ–¥ `getProgress()` - —Ä–∞—Å—á—ë—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - –ú–µ—Ç–æ–¥ `sendOrUpdateWizard()` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –í—Å–µ –º–µ—Ç–æ–¥—ã `ask*()` –∏ `handle*()` –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º

## –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä

–ü—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–æ:
- **0%** (IDLE): `‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 0%`
- **10%** (SELECT_STORE): `‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 10%`
- **30%** (SELECT_CATEGORY): `‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 30%`
- **50%** (SELECT_PROBLEM): `‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë 50%`
- **70%** (ENTER_DESCRIPTION): `‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë 70%`
- **85%** (UPLOAD_FILE): `‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 85%`
- **95%** (CONFIRM): `‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë 95%`

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

```
üé´ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏

üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: [–ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä]

[–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:]
‚úÖ –ú–∞–≥–∞–∑–∏–Ω: [–Ω–∞–∑–≤–∞–Ω–∏–µ]
‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: [–Ω–∞–∑–≤–∞–Ω–∏–µ]
‚úÖ –ü—Ä–æ–±–ª–µ–º–∞: [–Ω–∞–∑–≤–∞–Ω–∏–µ]
‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ: [–∫—Ä–∞—Ç–∫–∏–π —Ç–µ–∫—Å—Ç...]

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

[–¢–µ–∫—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏]
[–ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞]
```

## –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
php artisan migrate
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `php artisan telegram:polling`
2. –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç —Å –±–æ—Ç–æ–º –≤ Telegram
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
4. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º wizard'–∞
5. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:
   - –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ **—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è**, –∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ
   - –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è
   - –í—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤—ã—à–µ
   - –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —á–∏—Å—Ç–æ–π

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–í–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è:** –ü—Ä–∏ –≤–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (—ç—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Ç.–∫. Telegram API –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á—É–∂–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è)

2. **–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:** –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç wizard'–∞

## –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —à–∞–≥—É
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ" –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ
- [ ] –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä (–µ—Å–ª–∏ Telegram API –ø–æ–∑–≤–æ–ª–∏—Ç)

## Troubleshooting

### –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –£ –±–æ—Ç–∞ –Ω–µ—Ç `message_id` –≤ —Å–µ—Å—Å–∏–∏
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏ –ø–æ–ª–µ `message_id` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É

### –°—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ä—ã–µ —Å–µ—Å—Å–∏–∏ –Ω–µ –∏–º–µ—é—Ç `message_id`
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –∑–∞–Ω–æ–≤–æ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### Telegram API Error: "Message is not modified"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ø—ã—Ç–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π —Ç–µ–∫—Å—Ç
**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –æ—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞
