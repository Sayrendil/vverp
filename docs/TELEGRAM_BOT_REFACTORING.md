# Telegram Bot - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ª—É—á—à–µ–Ω–∏—è

## üìä –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –¢–æ–∫–µ–Ω –≤ .env
**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–æ–∫–µ–Ω –±—ã–ª –∑–∞–∫–æ–º–º–∏—á–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω–æ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `config/telegram.php`

```php
// –ë—ã–ª–æ:
'bot_token' => env('TELEGRAM_BOT_TOKEN', '8532780831:AAE...'),

// –°—Ç–∞–ª–æ:
'bot_token' => env('TELEGRAM_BOT_TOKEN'),
```

---

### ‚úÖ 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞ –≤ getFile()
**–ü—Ä–æ–±–ª–µ–º–∞:**
- URL —Å–æ–¥–µ—Ä–∂–∞–ª —Ç–æ–∫–µ–Ω –¥–≤–∞–∂–¥—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è POST –≤–º–µ—Å—Ç–æ GET

**–†–µ—à–µ–Ω–∏–µ:**
```php
// –ë—ã–ª–æ:
->post("{$this->apiUrl}{$this->botToken}/getFile", [...])

// –°—Ç–∞–ª–æ:
->get("{$this->apiUrl}/getFile", [...])
```

**–§–∞–π–ª:** `app/Services/TelegramBotService.php`

---

### ‚úÖ 3. –û—á–∏—Å—Ç–∫–∞ expired —Å–µ—Å—Å–∏–π

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

#### üìÑ –ö–æ–º–∞–Ω–¥–∞ –æ—á–∏—Å—Ç–∫–∏
**–§–∞–π–ª:** `app/Console/Commands/CleanExpiredSessions.php`

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
php artisan telegram:clean-sessions           # –° –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
php artisan telegram:clean-sessions --force   # –ë–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ù–∞—Ö–æ–¥–∏—Ç —Å–µ—Å—Å–∏–∏ –≥–¥–µ `expires_at < now()`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- –£–¥–∞–ª—è–µ—Ç –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

#### üìÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
**–§–∞–π–ª:** `routes/console.php`

```php
Schedule::command('telegram:clean-sessions --force')
    ->hourly()                  // –ö–∞–∂–¥—ã–π —á–∞—Å
    ->withoutOverlapping()      // –ë–µ–∑ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤
    ->runInBackground();        // –í —Ñ–æ–Ω–µ
```

**–î–ª—è —Ä–∞–±–æ—Ç—ã** –Ω—É–∂–µ–Ω cron (–≤ production):
```bash
* * * * * cd /path-to-project && php artisan schedule:run >> /dev/null 2>&1
```

---

### ‚úÖ 4. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

#### üì¶ ValidationService
**–§–∞–π–ª:** `app/Services/Telegram/ValidationService.php`

**–ú–µ—Ç–æ–¥—ã:**
- `validateDescription()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è (20-4096 —Å–∏–º–≤–æ–ª–æ–≤, —Å–ø–∞–º, —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–º–≤–æ–ª—ã)
- `validateId()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ ID —Å—É—â–Ω–æ—Å—Ç–µ–π
- `validateAttachments()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ (–º–∞–∫—Å 10, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- `validateChatId()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ Telegram Chat ID
- `sanitizeHtml()` - –æ—á–∏—Å—Ç–∫–∞ HTML –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `validateSessionData()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–∏–∫–µ—Ç–∞

#### üìã Request –∫–ª–∞—Å—Å
**–§–∞–π–ª:** `app/Http/Requests/Telegram/CreateTicketRequest.php`

–ì–æ—Ç–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ API endpoints.

#### üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
**–§–∞–π–ª:** `app/Services/TelegramWizardService.php`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–æ –≤—Å–µ –º–µ—Ç–æ–¥—ã:
- `handleDescription()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ + —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è
- `handleStoreSelection()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è ID –º–∞–≥–∞–∑–∏–Ω–∞
- `handleCategorySelection()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `handleProblemSelection()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è ID –ø—Ä–æ–±–ª–µ–º—ã
- `createTicket()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º

**–ü—Ä–∏–º–µ—Ä—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
```php
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è
$validation = $this->validator->validateDescription($description);
if (!$validation['valid']) {
    $this->bot->sendMessage($chatId, $validation['error']);
    return;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ ID
$validation = $this->validator->validateId($storeId, '–º–∞–≥–∞–∑–∏–Ω–∞');
if (!$validation['valid']) {
    $this->bot->sendMessage($chatId, $validation['error']);
    return;
}
```

---

### ‚úÖ 5. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ TelegramBotPolling –Ω–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

**–ü–∞—Ç—Ç–µ—Ä–Ω:** Chain of Responsibility + Strategy

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```
TelegramBotPolling (Command)
    ‚Üì
UpdateDispatcher (–î–∏—Å–ø–µ—Ç—á–µ—Ä)
    ‚Üì
Handlers (–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏):
    ‚îú‚îÄ CommandHandler       ‚Üí /start, /help, /cancel
    ‚îú‚îÄ CallbackQueryHandler ‚Üí –ù–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏
    ‚îú‚îÄ MediaHandler         ‚Üí –§–æ—Ç–æ, –≤–∏–¥–µ–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã
    ‚îî‚îÄ TextMessageHandler   ‚Üí –û–±—ã—á–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

**1. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞**
`app/Services/Telegram/Handlers/UpdateHandler.php`
```php
interface UpdateHandler {
    public function supports(array $update): bool;
    public function handle(array $update): void;
}
```

**2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥**
`app/Services/Telegram/Handlers/CommandHandler.php`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å /
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç CommandRouter –¥–ª—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏–∏

**3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback queries**
`app/Services/Telegram/Handlers/CallbackQueryHandler.php`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ inline –∫–Ω–æ–ø–∫–∏
- –ü–∞—Ä—Å–∏—Ç callback_data –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã wizard'–∞

**4. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–¥–∏–∞**
`app/Services/Telegram/Handlers/MediaHandler.php`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç file_id –≤ —Å–µ—Å—Å–∏—é

**5. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–∞**
`app/Services/Telegram/Handlers/TextMessageHandler.php`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±—ã—á–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞ –≤ wizard'–µ

**6. –î–∏—Å–ø–µ—Ç—á–µ—Ä**
`app/Services/Telegram/UpdateDispatcher.php`
- –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ —Ü–µ–ø–æ—á–∫–µ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥—è—â–∏–π
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. `TelegramBotPolling` –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
2. `UpdateDispatcher.dispatch($update)` –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º
3. –ö–∞–∂–¥—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `supports($update)`
4. –ü–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≤—ã–∑—ã–≤–∞–µ—Ç `handle($update)`

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- ‚úÖ **Single Responsibility** - –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –¥–µ–ª–∞–µ—Ç –æ–¥–Ω–æ –¥–µ–ª–æ
- ‚úÖ **Open/Closed** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - —Ç–µ—Å—Ç–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚úÖ **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** - –ø–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã —Å ~369 –¥–æ ~126 —Å—Ç—Ä–æ–∫

---

### ‚úÖ 6. –°–∏—Å—Ç–µ–º–∞ —Ä–æ—É—Ç–∏–Ω–≥–∞ –∫–æ–º–∞–Ω–¥

**–ê–Ω–∞–ª–æ–≥–∏—è:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ `routes/web.php` –≤ Laravel

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

**1. –†–æ—É—Ç–µ—Ä –∫–æ–º–∞–Ω–¥**
`app/Services/Telegram/CommandRouter.php`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- Middleware –¥–ª—è –∫–æ–º–∞–Ω–¥
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–æ–º–∞–Ω–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è /help
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```php
// –ü—Ä–æ—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞
$router->command('/start', [StartCommand::class, 'handle'])
    ->description('–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É');

// –° middleware
$router->command('/admin', [AdminCommand::class, 'handle'])
    ->middleware(function($context, $next) {
        if (!isAdmin($context['userId'])) {
            return "Access denied";
        }
        return $next();
    });

// –ì—Ä—É–ø–ø–∞ –∫–æ–º–∞–Ω–¥
$router->group(['middleware' => [AuthMiddleware::class]], function($router) {
    $router->command('/profile', [ProfileCommand::class, 'handle']);
    $router->command('/settings', [SettingsCommand::class, 'handle']);
});
```

**2. –§–∞–π–ª —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥**
`app/Services/Telegram/routes.php`

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ:
```php
return function (CommandRouter $router) {
    $router->command('/start', [StartCommand::class, 'handle'])
        ->description('–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É');

    $router->command('/cancel', [CancelCommand::class, 'handle'])
        ->description('–û—Ç–º–µ–Ω–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏');

    // ...
};
```

**3. –ö–ª–∞—Å—Å—ã –∫–æ–º–∞–Ω–¥**
- `app/Services/Telegram/Commands/StartCommand.php`
- `app/Services/Telegram/Commands/CancelCommand.php`
- `app/Services/Telegram/Commands/SkipCommand.php`
- `app/Services/Telegram/Commands/HelpCommand.php`

–ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ - –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–æ–º `handle()`:
```php
class StartCommand {
    public function handle(array $context): void {
        $userId = $context['userId'];
        $chatId = $context['chatId'];
        $this->wizard->start($userId, $chatId);
    }
}
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** –∫–æ–º–∞–Ω–¥ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
- ‚úÖ **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∫–æ–º–∞–Ω–¥—ã –∫–∞–∫ –∫–ª–∞—Å—Å—ã
- ‚úÖ **Middleware** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π /help** - –æ–ø–∏—Å–∞–Ω–∏—è –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ä–æ—É—Ç–µ—Ä–∞
- ‚úÖ **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞** - –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≥—Ä—É–ø–ø—ã –∫–æ–º–∞–Ω–¥
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É:

1. –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å –≤ `app/Services/Telegram/Commands/`:
```php
class MyCommand {
    public function handle(array $context): void {
        // –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã
    }
}
```

2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `routes.php`:
```php
$router->command('/mycommand', [MyCommand::class, 'handle'])
    ->description('–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã');
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:

```
app/
‚îú‚îÄ‚îÄ Console/Commands/
‚îÇ   ‚îú‚îÄ‚îÄ CleanExpiredSessions.php          ‚Üê –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ TelegramBotPolling.php            ‚Üê –û–±–Ω–æ–≤–ª–µ–Ω
‚îú‚îÄ‚îÄ Http/Requests/Telegram/
‚îÇ   ‚îî‚îÄ‚îÄ CreateTicketRequest.php           ‚Üê –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è API
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ TelegramBotService.php            ‚Üê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω getFile()
‚îÇ   ‚îú‚îÄ‚îÄ TelegramWizardService.php         ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ Telegram/
‚îÇ       ‚îú‚îÄ‚îÄ CommandRouter.php             ‚Üê –†–æ—É—Ç–µ—Ä –∫–æ–º–∞–Ω–¥
‚îÇ       ‚îú‚îÄ‚îÄ UpdateDispatcher.php          ‚Üê –î–∏—Å–ø–µ—Ç—á–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ ValidationService.php         ‚Üê –í–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ routes.php                    ‚Üê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
‚îÇ       ‚îú‚îÄ‚îÄ Commands/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ StartCommand.php
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CancelCommand.php
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ SkipCommand.php
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ HelpCommand.php
‚îÇ       ‚îî‚îÄ‚îÄ Handlers/
‚îÇ           ‚îú‚îÄ‚îÄ UpdateHandler.php         ‚Üê –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ           ‚îú‚îÄ‚îÄ CommandHandler.php
‚îÇ           ‚îú‚îÄ‚îÄ CallbackQueryHandler.php
‚îÇ           ‚îú‚îÄ‚îÄ MediaHandler.php
‚îÇ           ‚îî‚îÄ‚îÄ TextMessageHandler.php
routes/
‚îî‚îÄ‚îÄ console.php                           ‚Üê –î–æ–±–∞–≤–ª–µ–Ω Schedule
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å autoload
composer dump-autoload

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∫–æ–º–∞–Ω–¥—ã –æ—á–∏—Å—Ç–∫–∏
php artisan telegram:clean-sessions

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
php artisan telegram:polling
```

### –î–ª—è production:

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron –¥–ª—è Schedule
crontab -e
# –î–æ–±–∞–≤–∏—Ç—å:
* * * * * cd /path-to-project && php artisan schedule:run >> /dev/null 2>&1

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å supervisor –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
# (–∫–æ–Ω—Ñ–∏–≥ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ)
```

---

## üìù –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ø–∞–º—è—Ç–∏)

7. Events/Listeners –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
8. Queue –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
9. Middleware –¥–ª—è Telegram (Auth, RateLimit)
10. State Machine (Symfony Workflow)
11. DTO –≤–º–µ—Å—Ç–æ –º–∞—Å—Å–∏–≤–æ–≤
12. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
13. Supervisor –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
14. Webhook –≤–º–µ—Å—Ç–æ Polling (–¥–ª—è production)

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- TelegramBotPolling: **369 —Å—Ç—Ä–æ–∫**
- –í—Å–µ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
- Switch/match –¥–ª—è –∫–æ–º–∞–Ω–¥
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –¢–æ–∫–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –ë–∞–≥ –≤ getFile()
- Expired —Å–µ—Å—Å–∏–∏ –∫–æ–ø—è—Ç—Å—è

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
- TelegramBotPolling: **126 —Å—Ç—Ä–æ–∫** (-66%)
- –†–∞–∑–¥–µ–ª–µ–Ω–æ –Ω–∞ **14 —Ñ–∞–π–ª–æ–≤**
- –†–æ—É—Ç–µ—Ä –¥–ª—è –∫–æ–º–∞–Ω–¥
- –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –¢–æ–∫–µ–Ω –≤ .env
- –ë–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:
- ‚úÖ SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã
- ‚úÖ Design patterns (Chain of Responsibility, Strategy, Router)
- ‚úÖ –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Telegram –±–æ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω:
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚úÖ
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚úÖ
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** ‚úÖ
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚úÖ
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** ‚úÖ

–ö–æ–¥ —Å—Ç–∞–ª –±–æ–ª–µ–µ —á–∏—Å—Ç—ã–º, –ø–æ–Ω—è—Ç–Ω—ã–º –∏ –ª–µ–≥–∫–∏–º –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏.
