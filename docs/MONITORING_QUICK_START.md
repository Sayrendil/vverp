# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ú–æ–¥—É–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –®–∞–≥ 1: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```bash
cd ~/vkusvill/vverp
php artisan migrate
```

## –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Ö–æ—Å—Ç—ã

–ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ ‚Üí –•–æ—Å—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**
2. –ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å —Ö–æ—Å—Ç"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - –ú–∞–≥–∞–∑–∏–Ω: –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞
   - –ù–∞–∑–≤–∞–Ω–∏–µ: "–ö–∞—Å—Å–∞ 1"
   - IP –∞–¥—Ä–µ—Å: 192.168.1.100
   - –ê–∫—Ç–∏–≤–µ–Ω: ‚úÖ
   - –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏: 5 –º–∏–Ω—É—Ç
   - –¢–∞–π–º–∞—É—Ç: 3 —Å–µ–∫—É–Ω–¥—ã

## –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å Queue Worker

**–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Development):**
```bash
php artisan queue:work --queue=monitoring
```

–û—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–∫—Ä—ã—Ç—ã–º.

## –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏

–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ö–æ—Å—Ç—ã
php artisan monitoring:check-hosts --all

# –ò–õ–ò —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
php artisan monitoring:check-hosts --all --sync
```

## –®–∞–≥ 5: –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–ß–µ—Ä–µ–∑ CLI:**
```bash
# –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
php artisan monitoring:stats

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ö–æ—Å—Ç—É
php artisan monitoring:stats --host=1
```

**–ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/monitoring` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –£–≤–∏–¥–∏—Ç–µ –¥–∞—à–±–æ—Ä–¥ —Å –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ö–æ—Å—Ç –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

## –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Scheduler

```bash
php artisan schedule:list
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
- `monitoring:check-hosts` - –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- `monitoring:clean-logs --days=30` - –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 03:00

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ cron –Ω–∞—Å—Ç—Ä–æ–µ–Ω:

```bash
crontab -l
```

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:
```
* * * * * cd /home/erp/vverp && php artisan schedule:run >> /dev/null 2>&1
```

## –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Production Queue Worker

–°–æ–∑–¥–∞–π—Ç–µ Supervisor –∫–æ–Ω—Ñ–∏–≥:

```bash
sudo nano /etc/supervisor/conf.d/vverp-monitoring-queue.conf
```

–í—Å—Ç–∞–≤—å—Ç–µ:
```ini
[program:vverp-monitoring-queue]
process_name=%(program_name)s_%(process_num)02d
command=php /home/erp/vverp/artisan queue:work --queue=monitoring --sleep=3 --tries=2 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=erp
numprocs=2
redirect_stderr=true
stdout_logfile=/home/erp/vverp/storage/logs/monitoring-queue.log
stopwaitsecs=3600
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ:
```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start vverp-monitoring-queue:*
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Queue Worker

```bash
sudo supervisorctl status vverp-monitoring-queue:*
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `RUNNING`

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
tail -f storage/logs/laravel.log | grep -i monitoring
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```bash
php artisan tinker
```

```php
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–æ–≤
App\Models\HostAvailabilityLog::count();

// –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ø—Ä–æ–≤–µ—Ä–æ–∫
App\Models\HostAvailabilityLog::latest('checked_at')->take(5)->get();
```

## üéØ –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –î–æ–±–∞–≤–∏—Ç—å 10 –∫–∞—Å—Å –º–∞–≥–∞–∑–∏–Ω–∞

```php
use App\Models\Host;
use App\Models\Store;

$store = Store::find(1);

for ($i = 1; $i <= 10; $i++) {
    Host::create([
        'store_id' => $store->id,
        'name' => "–ö–∞—Å—Å–∞ {$i}",
        'ip_address' => "192.168.1." . (100 + $i),
        'description' => "–ö–∞—Å—Å–∞ –Ω–æ–º–µ—Ä {$i}",
        'is_active' => true,
        'check_interval' => 5,
        'timeout' => 3,
    ]);
}
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–∞–π—Ç–∏ –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Ö–æ—Å—Ç—ã

```bash
php artisan monitoring:problematic
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ú–∞—Å—Å–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ö–æ—Å—Ç–æ–≤ –º–∞–≥–∞–∑–∏–Ω–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ö–æ—Å—Ç—ã –º–∞–≥–∞–∑–∏–Ω–∞ ID=5
php artisan monitoring:check-hosts --store=5
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Queue Worker: `sudo supervisorctl status vverp-monitoring-queue:*`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `sudo supervisorctl restart vverp-monitoring-queue:*`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f storage/logs/monitoring-queue.log`

### –ü—Ä–æ–±–ª–µ–º–∞: –í—Å–µ —Ö–æ—Å—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ping –≤—Ä—É—á–Ω—É—é: `ping 192.168.1.100`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞: `ls -la $(which ping)`
3. –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ö–æ—Å—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞: Failed jobs –≤ –æ—á–µ—Ä–µ–¥–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ failed jobs: `php artisan queue:failed`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫: `storage/logs/laravel.log`
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ failed job: `php artisan queue:retry all`

## üìà –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ —Ö–æ—Å—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram (–±—É–¥—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
3. ‚úÖ –°–æ–∑–¥–∞–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ –≤–∏–¥–∂–µ—Ç—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
4. ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ—Ç—á–µ—Ç—ã –¥–ª—è —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–º. [MONITORING_MODULE.md](MONITORING_MODULE.md)
