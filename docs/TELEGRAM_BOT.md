# Telegram Bot - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ TelegramBotService.php           # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram API
‚îÇ   ‚îî‚îÄ‚îÄ TelegramNotificationService.php  # –°–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ê–•–û —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º
‚îî‚îÄ‚îÄ Console/Commands/
    ‚îî‚îÄ‚îÄ TelegramBotPolling.php           # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ (Long Polling)

config/
‚îî‚îÄ‚îÄ telegram.php                         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ @BotFather
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π **—Ç–æ–∫–µ–Ω**

### 2. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_BOT_USERNAME=your_bot_username
TELEGRAM_ADMIN_CHAT_IDS=123456789,987654321

# Polling Settings
TELEGRAM_POLLING_TIMEOUT=30
TELEGRAM_POLLING_LIMIT=100

# Logging
TELEGRAM_LOGGING_ENABLED=true
TELEGRAM_LOG_CHANNEL=daily
```

---

## üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

### –í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:

```bash
# –ó–∞–ø—É—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ
docker-compose exec app php artisan telegram:polling

# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ
docker-compose exec -d app php artisan telegram:polling

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
docker-compose exec app php artisan telegram:polling --timeout=60 --limit=50
```

### –õ–æ–∫–∞–ª—å–Ω–æ:

```bash
php artisan telegram:polling
```

---

## üì¶ –°–µ—Ä–≤–∏—Å—ã

### **TelegramBotService**

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Telegram Bot API.

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `getUpdates()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (Long Polling)
- `sendMessage()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- `sendMessageWithButtons()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–Ω–æ–ø–∫–∞–º–∏
- `answerCallbackQuery()` - –æ—Ç–≤–µ—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏
- `editMessage()` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `getUserInfo()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `getMe()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ

### **TelegramNotificationService**

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ê–•–û —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º.

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `notifyNewTicket()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ
- `notifyStatusChange()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
- `notifyReminder()` - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π –∑–∞—è–≤–∫–µ

---

## ü§ñ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ (–ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ)

### –î–ª—è –ê–•–û —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤:

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ –∏ –ø—Ä–∏–≤—è–∑–∫–∞ Telegram ID |
| `/mytickets` | –°–ø–∏—Å–æ–∫ –º–æ–∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ |
| `/ticket_ID` | –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∑–∞—è–≤–∫–∏ |
| `/status_ID_STATUS` | –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |

---

## üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ:

```
üÜï –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ #123

üìç –ú–∞–≥–∞–∑–∏–Ω: "–ü—è—Ç—ë—Ä–æ—á–∫–∞ –Ω–∞ –õ–µ–Ω–∏–Ω–∞, 25"
üè™ –ê–¥—Ä–µ—Å: —É–ª. –õ–µ–Ω–∏–Ω–∞, 25
üîß –ü—Ä–æ–±–ª–µ–º–∞: –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
üìù –û–ø–∏—Å–∞–Ω–∏–µ: –ù–µ –º–æ—Ä–æ–∑–∏—Ç, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ +10¬∞C

üë§ –ê–≤—Ç–æ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω
‚òéÔ∏è –ö–æ–Ω—Ç–∞–∫—Ç: +7 999 123-45-67

‚è∞ –°–æ–∑–¥–∞–Ω–∞: 12.11.2025 14:30

–ö–æ–º–∞–Ω–¥—ã:
/ticket_123 - –ü–æ–¥—Ä–æ–±–Ω–µ–µ
```

–° –∫–Ω–æ–ø–∫–∞–º–∏:
- [üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ] [‚úÖ –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É]
- [üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å] [‚úâÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å]

---

## üîÑ Workflow

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ê–•–û —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞:

```
–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç ‚Üí /start ‚Üí –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–æ–¥ ‚Üí
–í–≤–æ–¥–∏—Ç –∫–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã ‚Üí Telegram ID –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏:

```
–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–æ–∑–¥–∞–µ—Ç –∑–∞—è–≤–∫—É –≤ web ‚Üí
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –ê–•–û —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ ‚Üí
–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram ‚Üí
–ú–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```

### 3. –†–∞–±–æ—Ç–∞ —Å –∑–∞—è–≤–∫–æ–π:

```
–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí
–ù–∞–∂–∏–º–∞–µ—Ç "–í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É" ‚Üí
–°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ ‚Üí
–ê–≤—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí
–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É ‚Üí
–ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞–≤–µ—Ä—à–µ–Ω–æ" ‚Üí
–°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
```

---

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
2. ‚è≥ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è TelegramBotService
3. ‚è≥ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥
4. ‚è≥ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ê–•–û —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
5. ‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
6. ‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
7. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –±–æ—Ç–∞
tail -f storage/logs/laravel.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–ª—å–∫–æ Telegram –ª–æ–≥–æ–≤
tail -f storage/logs/laravel.log | grep "Telegram"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:

```bash
# –ß–µ—Ä–µ–∑ tinker
docker-compose exec app php artisan tinker
>>> app(App\Services\TelegramBotService::class)->getMe()
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Long Polling vs Webhooks:**
   - Long Polling - –ø—Ä–æ—â–µ, —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ
   - Webhooks - –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –Ω—É–∂–µ–Ω HTTPS –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–π URL

2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env`
   - –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ git
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - Long Polling –¥–µ—Ä–∂–∏—Ç –æ—Ç–∫—Ä—ã—Ç–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
   - –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ supervisor –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞

4. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API:**
   - 30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
   - 1 –∑–∞–ø—Ä–æ—Å –≤ —Å–µ–∫—É–Ω–¥—É –∫ –æ–¥–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Telegram Bot API Documentation](https://core.telegram.org/bots/api)
- [BotFather](https://t.me/botfather)
- [Telegram Bots FAQ](https://core.telegram.org/bots/faq)

---

## üîú –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ `.env`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã TelegramBotService
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–º–∞–Ω–¥
5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º –±–æ—Ç–æ–º
